name: ğŸ³ Main Branch Docker Publisher

on:
  push:
    branches:
      - main
  workflow_dispatch:

run-name: ğŸ³ Docker Publish by @${{ github.actor }} for commit ${{ github.sha }}

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  call-reusable-build:
    name: Build and Push Main Image
    permissions:
      contents: read
      packages: write
    # ä½¿ç”¨å¯å¤ç”¨å·¥ä½œæµ
    uses: ./.github/workflows/reusable-build.yml
    with:
      # ç”Ÿæˆé•œåƒæ ‡ç­¾ï¼šä¸€ä¸ªåŸºäºåˆ†æ”¯åï¼Œä¸€ä¸ªåŸºäº commit SHA
      tags: |
        ghcr.io/${{ github.repository }}:${{ github.ref_name }}
        ghcr.io/${{ github.repository }}:${{ github.sha }}
      push: true
      # ä¸»åˆ†æ”¯æ¨é€åªæ„å»º AMD64ï¼Œæé«˜é€Ÿåº¦
      build_arm64: false
    secrets:
      DOCKER_REGISTRY_TOKEN: ${{ secrets.GITHUB_TOKEN }}